import numpy as np
import matplotlib.pyplot as plt

x_axis = np.arange(49)

#resnet20
bit0 = [103737, 82435, 75690, 77282, 79869, 85451, 93216, 102383, 111087, 117470, 123845, 129456, 133102, 135338, 138561, 140847, 141759, 144502, 144731, 145391, 146794, 148272, 149232, 148754, 150001, 149930, 149867, 152261, 151414, 150556, 151797, 151759, 151428, 152208, 152266, 152557, 151955, 152131, 153235, 151663, 152906, 153420, 152348, 151565, 153216, 153218, 151980, 152437, 153317]
scalar0 = [11.377960594683756, 10.883873720944397, 9.615604607621199, 8.684534847387102, 8.021232905390264, 7.264095804153807, 6.415740004194972, 5.345188012695854, 4.148742207045826, 3.010765696470134, 1.623892905238832, 0.46906268697055925, -0.7157589892195351, -1.8888976811140181, -2.862707372922233, -3.895949262521797, -4.280186195595911, -5.33660682564729, -5.712037911877695, -6.107882668053255, -6.945233245584002, -7.559915988132188, -7.595495492960266, -7.448127304036431, -8.567609960722617, -8.046027441138017, -8.219214248470973, -9.329407242777995, -8.987984867344448, -8.5036567167481, -9.173714500459015, -9.096896319944786, -8.461002029376663, -9.144495210632162, -9.797035448153807, -9.33106463376131, -8.796193940244862, -9.12226743270002, -9.448013251407236, -9.067168059551932, -9.841938404511957, -9.942032621926053, -8.876205145681526, -8.528801386165473, -9.945602096098778, -9.812751705489065, -8.680217917077213, -8.906862456569828, -10.141709595074655]
# acc = [0.36790865659713745, 0.5118389129638672, 0.582772433757782, 0.6307692527770996, 0.6730168461799622, 0.7067508101463318, 0.7346954941749573, 0.7585336565971375, 0.7782251834869385, 0.7928886413574219, 0.8088341355323792, 0.8203125, 0.8301081657409668, 0.8426482081413269, 0.854887843132019, 0.8594751358032227, 0.8705528974533081, 0.8766226172447205, 0.8838541507720947, 0.8910256624221802, 0.8939102292060852, 0.8992788195610046, 0.905468761920929, 0.9105769395828247, 0.9143429398536682, 0.917808473110199, 0.9238181114196777, 0.9230969548225403, 0.925620973110199, 0.9305288195610046, 0.9305087924003601, 0.9311097860336304, 0.9382612109184265, 0.9413661956787109, 0.9373798370361328, 0.9379407167434692, 0.9385015964508057, 0.9473557472229004, 0.9427283406257629, 0.9465544819831848, 0.9428685903549194, 0.9422275424003601, 0.946173906326294, 0.950861394405365, 0.9489182829856873, 0.9448117017745972, 0.9451121687889099, 0.9524639248847961, 0.9461337924003601, 0.9489383101463318]
# loss = [2.033569097518921, 1.6510624885559082, 1.4590555429458618, 1.3220164775848389, 1.2082335948944092, 1.112661361694336, 1.0362226963043213, 0.9707622528076172, 0.9165696501731873, 0.8721916675567627, 0.8342930674552917, 0.8067852258682251, 0.7764330506324768, 0.7536200881004333, 0.7286461591720581, 0.7129090428352356, 0.6957305073738098, 0.685218870639801, 0.6693870425224304, 0.6555196642875671, 0.6515198349952698, 0.6391440629959106, 0.6311308741569519, 0.6184064745903015, 0.6148050427436829, 0.6077947616577148, 0.5935072898864746, 0.5931289792060852, 0.5915908813476562, 0.580727219581604, 0.5800046324729919, 0.5769149661064148, 0.5594953298568726, 0.553281307220459, 0.5652326345443726, 0.5604913830757141, 0.56069016456604, 0.538135290145874, 0.5463865995407104, 0.5356383323669434, 0.5426854491233826, 0.5474514961242676, 0.5358058214187622, 0.5200467109680176, 0.5240108966827393, 0.5359552502632141, 0.5307663679122925, 0.5121884346008301, 0.5282484889030457, 0.5196706652641296]

#resnet32
bit1 = [181344, 146109, 138509, 143395, 150389, 161370, 172668, 186251, 202240, 210911, 219988, 226532, 231167, 236771, 239526, 241319, 245384, 246051, 248637, 249947, 250133, 254350, 254696, 253041, 255380, 255170, 256774, 255454, 256577, 257513, 255772, 258372, 257070, 258057, 258007, 256448, 257640, 258821, 258436, 257936, 258933, 257814, 259186, 258008, 258311, 259313, 257279, 259402, 259471]
scalar1 = [11.546611279587523, 11.20565503080795, 10.385491203051046, 9.515029518282994, 8.899564022052832, 8.098126738972468, 7.312635068228734, 6.00427304410354, 3.8308256788150126, 2.525773325127297, 0.7569151890566236, -0.7148008465196518, -2.246926055793664, -3.390918615487022, -4.681760714578636, -5.19157530963992, -6.729622387014422, -6.503702124349335, -7.580783134380941, -8.025987687364163, -8.222441647748468, -9.90335384088392, -9.630987455522765, -9.279568993131663, -9.960817590617918, -9.759077460439542, -10.11790619704337, -9.597426421434625, -9.939355993904233, -10.180597936861448, -10.025912891876933, -10.457052269615863, -9.539375232197907, -10.31139807395811, -9.996885652391935, -9.869763720673314, -10.076044694706077, -10.366759339725792, -9.882142888296068, -9.829349695381056, -10.24041150500848, -9.756385079184819, -10.091360755155598, -9.882753452600857, -10.262339008562737, -10.18868830757215, -9.276346224149203, -10.548605597169663, -9.54457178241861]
# acc = [0.3559495210647583, 0.49168670177459717, 0.5640023946762085, 0.6153044700622559, 0.6554086804389954, 0.6899038553237915, 0.721173882484436, 0.7467548251152039, 0.7681289911270142, 0.7870593070983887, 0.8051682710647583, 0.8189904093742371, 0.832191526889801, 0.8425280451774597, 0.8520432710647583, 0.8647836446762085, 0.8729767799377441, 0.8803685903549194, 0.8886218070983887, 0.8940705060958862, 0.9003806114196777, 0.9058293104171753, 0.9108573794364929, 0.9175480604171753, 0.9182892441749573, 0.9236578345298767, 0.9264022707939148, 0.9287259578704834, 0.9296274185180664, 0.933754026889801, 0.9376402497291565, 0.9347556233406067, 0.9413862228393555, 0.9388421177864075, 0.9429086446762085, 0.9489983916282654, 0.9432492256164551, 0.944451093673706, 0.9471153616905212, 0.9489783644676208, 0.9496995210647583, 0.951642632484436, 0.9499799609184265, 0.9508413672447205, 0.9507611989974976, 0.9487980604171753, 0.9558493494987488, 0.9527443647384644, 0.9513822197914124, 0.9607171416282654]
# loss = [2.267465591430664, 1.8668116331100464, 1.6648478507995605, 1.5148234367370605, 1.394132137298584, 1.2879282236099243, 1.1969720125198364, 1.118537425994873, 1.0519548654556274, 1.0030301809310913, 0.9531064033508301, 0.9156003594398499, 0.8811923861503601, 0.8553645014762878, 0.827434778213501, 0.8040741086006165, 0.7796022891998291, 0.7652867436408997, 0.7453338503837585, 0.7350116968154907, 0.7177616357803345, 0.7051317095756531, 0.6972525715827942, 0.6840802431106567, 0.6795212030410767, 0.6676099896430969, 0.6560078263282776, 0.6516918540000916, 0.6489102244377136, 0.6370400190353394, 0.625581681728363, 0.6293386220932007, 0.6135604977607727, 0.6189448833465576, 0.6083168387413025, 0.5899113416671753, 0.6022804975509644, 0.5942856669425964, 0.5873738527297974, 0.5813488960266113, 0.5771512389183044, 0.5674939751625061, 0.5687036514282227, 0.5678134560585022, 0.5642516613006592, 0.5692862272262573, 0.5462169051170349, 0.5535714030265808, 0.5568604469299316, 0.5283870697021484]

#resnet56
bit2 = [325413, 245297, 226233, 230798, 252646, 275296, 296688, 319883, 345413, 368083, 384644, 395213, 409321, 416215, 426741, 430881, 437935, 441799, 445014, 448677, 451992, 453686, 456220, 458199, 458495, 460867, 458820, 459838, 463463, 462629, 462273, 465000, 463069, 465234, 464815, 465760, 467225, 464091, 465997, 467075, 466871, 467997, 468604, 467169, 468424, 468680, 470091, 467045, 470254]
scalar2 = [11.588199125446405, 12.220033553538084, 11.41196409335313, 10.502773079490005, 9.858050360987157, 9.317071536395822, 8.462309018392233, 7.440948030995042, 5.704819139416942, 3.9717521885444746, 2.440800569594985, 1.2668705899455786, -0.5985834085686869, -1.5591357089852618, -3.3209707142563727, -3.8302651113916624, -5.30873127858564, -6.346743665406343, -6.799778233639962, -7.811579837891227, -8.130994859277084, -8.560313243903677, -9.148678308430572, -9.688119284092007, -9.738420836707569, -10.17128712458365, -9.438616135954508, -9.696378896833243, -10.723058449149855, -10.031066615081707, -9.765532754831794, -10.384097821657614, -9.953754806181689, -10.507402536133679, -9.823978369671698, -10.116752857138653, -10.390286570123859, -9.400205673858625, -9.756311562406603, -10.414759053951503, -10.512704804988108, -10.453108636284883, -10.211232629960254, -9.721813150925275, -10.340493462699586, -10.421300741114413, -10.500130472692081, -10.329081701811472, -10.304240970681361]
# acc = [0.2950921356678009 0.43369391560554504 0.5134214758872986 0.5689703822135925 0.6114984154701233 0.6472956538200378 0.6795472502708435 0.704767644405365 0.7271835207939148 0.7481369972229004 0.7686899304389954 0.7872396111488342 0.8043068647384644 0.8179486989974976 0.8309695720672607 0.8418469429016113 0.8519631624221802 0.8626001477241516 0.8744391202926636 0.8786658644676208 0.885817289352417 0.8938501477241516 0.9017027020454407 0.9103565812110901 0.9100561141967773 0.9144831895828247 0.9222556352615356 0.9205529093742371 0.9305689334869385 0.9337940812110901 0.9324118494987488 0.9353165030479431 0.9390023946762085 0.9391626715660095 0.9456129670143127 0.9383212924003601 0.9472956657409668 0.9464343190193176 0.9460737109184265 0.9520432949066162 0.9522035121917725 0.9485576748847961 0.9533053040504456 0.9583132863044739 0.950901448726654 0.9554086327552795 0.9539663195610046 0.9547275900840759 0.9567708373069763 0.9597555994987488]
# loss = [2.7786026000976562 2.3255484104156494 2.093820810317993 1.9143714904785156 1.7708346843719482 1.6502935886383057 1.543244481086731 1.4477722644805908 1.3658300638198853 1.2941683530807495 1.2295479774475098 1.1768765449523926 1.1193467378616333 1.075260043144226 1.0333614349365234 0.9974680542945862 0.9655365943908691 0.9387709498405457 0.9004021286964417 0.8886105418205261 0.8656411170959473 0.8433812856674194 0.8247156143188477 0.8035293817520142 0.7971722483634949 0.7839725017547607 0.7618157267570496 0.7614938020706177 0.7376735806465149 0.7240738868713379 0.7204515337944031 0.707976758480072 0.6998160481452942 0.6940593719482422 0.6734456419944763 0.6898979544639587 0.6639072299003601 0.6643627285957336 0.6595649123191833 0.6394914984703064 0.6344267129898071 0.641423225402832 0.6243201494216919 0.6052597165107727 0.6237057447433472 0.6093739867210388 0.6080124974250793 0.6002752780914307 0.5966115593910217 0.5798218250274658]

#resnet110
bit3= [685644, 430334, 447701, 472299, 507757, 540407, 576421, 626318, 679427, 725533, 764933, 796840, 823014, 841613, 861596, 871721, 883603, 894050, 900218, 905866, 907159, 914601, 916244, 921978, 918062, 928348, 921823, 922866, 925027, 927461, 928638, 925059, 924966, 930816, 928025, 932316, 932431, 936753, 932692, 929963, 934839, 935663, 936478, 937974, 929126, 936587, 933282, 940114, 938175]
scalar3= [-7.6831658064806145, 14.390228799091357, 14.356723202128727, 14.642999731621357, 14.459207398492248, 14.221946703983118, 13.544617478304637, 12.49249374235843, 10.816541453868908, 8.778678806677782, 6.3593035784023115, 3.736901063998186, 1.366795944486018, -0.8571624999497386, -3.503850657249784, -4.674254611717526, -6.951253350405291, -8.442643970960834, -9.088659335555311, -9.929721476029565, -10.048955950191518, -11.264899347931122, -11.380278710810385, -12.002163923941232, -11.163240665299778, -12.750859186796912, -11.231838628218357, -11.312716893810864, -11.684403125284902, -11.761645207146572, -11.67798619741279, -10.912971692713468, -10.69775770646128, -11.441709596404166, -10.964075968312802, -11.203340922263358, -11.638071282150571, -12.48634608381733, -11.275599558084421, -10.818609539597114, -11.359816654988792, -11.253029837939255, -12.18024050301518, -12.283052712386501, -10.624816433042236, -11.364048554787384, -11.13377336130132, -12.019429734300484, -11.015617968420223]
# acc= [0.24106571078300476, 0.35981571674346924, 0.42005208134651184, 0.46961137652397156, 0.5177884697914124, 0.5637820363044739, 0.6088742017745972, 0.6515224575996399, 0.6842948794364929, 0.7130809426307678, 0.7409455180168152, 0.7646033763885498, 0.7885416746139526, 0.8041867017745972, 0.8240184187889099, 0.8367788195610046, 0.8555088043212891, 0.8666466474533081, 0.8743389248847961, 0.8855368494987488, 0.8973357081413269, 0.9036057591438293, 0.9105167984962463, 0.9177884459495544, 0.9219350814819336, 0.9236378073692322, 0.9286859035491943, 0.9343950152397156, 0.9364182949066162, 0.9404447078704834, 0.9418669939041138, 0.9445913434028625, 0.9467347860336304, 0.9459936022758484, 0.9495592713356018, 0.9540064334869385, 0.9536057710647583, 0.9478365182876587, 0.9521234035491943, 0.9549078345298767, 0.9542468190193176, 0.9584535360336304, 0.9545472860336304, 0.9528445601463318, 0.9563100934028625, 0.9569711685180664, 0.9599559307098389, 0.9563902020454407, 0.9589142799377441, 0.9596354365348816]
# loss= [3.889521598815918, 3.3904881477355957, 3.148322343826294, 2.9367315769195557, 2.7327768802642822, 2.535881996154785, 2.354867935180664, 2.1895599365234375, 2.047365427017212, 1.9201449155807495, 1.8050148487091064, 1.7074726819992065, 1.618577480316162, 1.5398659706115723, 1.4682185649871826, 1.410028338432312, 1.3404541015625, 1.2975298166275024, 1.2583683729171753, 1.216797947883606, 1.1663904190063477, 1.1347014904022217, 1.1050195693969727, 1.0731405019760132, 1.045967698097229, 1.0293101072311401, 0.9970134496688843, 0.9713127613067627, 0.954960823059082, 0.9312922358512878, 0.9140694737434387, 0.8911883234977722, 0.8735727071762085, 0.8610337376594543, 0.8460462689399719, 0.8199248313903809, 0.8080105781555176, 0.8098597526550293, 0.7950257658958435, 0.7769539952278137, 0.7695080041885376, 0.7478929758071899, 0.7504236698150635, 0.7457517981529236, 0.7335073351860046, 0.7230225205421448, 0.7084234952926636, 0.714134156703949, 0.698517918586731, 0.6900487542152405]

num_param = [273562, 468442, 858202, 1735162]

bit_list = []
bit_list.append(bit0)
bit_list.append(bit1)
bit_list.append(bit2)
bit_list.append(bit3)

scalar_list = []
scalar_list.append(scalar0)
scalar_list.append(scalar1)
scalar_list.append(scalar2)
scalar_list.append(scalar3)

bit_index_dict = {}
scalar_index_dict = {}

for j in range(4):
    bit_index_dict[j] = [i for i in range(len(bit_list[j])) if bit_list[j][i]>num_param[j]/2]
    scalar_index_dict[j] = [i for i in range(len(scalar_list[j])) if scalar_list[j][i]<0]
    
    bit_index = bit_index_dict[j][0]
    scalar_index = scalar_index_dict[j][1]
    print(bit_index, scalar_index)

    fig, ax1 = plt.subplots()
    ax1.plot(x_axis, bit_list[j], color='blue', marker='.', label='xor')
    ax1.set_ylim([0,num_param[j]])
    ax1.axvline(bit_index, 0.2, 0.8,color='blue', linestyle='--')
    plt.legend(loc=(0.5,0.9))

    ax2 = ax1.twinx()
    ax2.plot(x_axis, scalar_list[j], color='red', marker='.', label='inner_product')
    ax1.axvline(scalar_index, 0.2, 0.8, color='red', linestyle='--')
    plt.legend(loc=(0.7,0.9))

    plt.savefig('bit_and_product' + str(j) + '.png')
    plt.clf()






# bit_index = bit_index_list[0]
# scalar_index = scalar_index_list[1]
# print(bit_index, scalar_index)

# acc = acc[:49]
# loss = loss[:49]

# fig, ax1 = plt.subplots()
# ax1.plot(x_axis, bit, color='blue', marker='.')
# ax1.set_ylim([0,1735162])
# ax1.axvline(bit_index, 0.2, 0.8,color='blue', linestyle='--')

# ax2 = ax1.twinx()
# ax2.plot(x_axis, scalar, color='red', marker='.')
# ax1.axvline(scalar_index, 0.2, 0.8, color='red', linestyle='--')

# plt.savefig('bit_and_product' + j + '.png')
# plt.clf()

# plt.plot(x_axis,acc)
# plt.savefig('acc.png')
# plt.clf()

# plt.plot(x_axis,scalar)
# plt.savefig('scalar.png')
# plt.clf()

# plt.plot(x_axis,bit)
# plt.savefig('bit.png')
# plt.clf()

# plt.plot(x_axis,loss)
# plt.savefig('loss.png')

# Num_parameters
# resnet20: 273562
# resnet32: 468442
# resnet56: 858202
# resnet110: 1735162